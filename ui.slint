import { VerticalBox } from "std-widgets.slint";

struct CPUData {
    number: int,
    active: bool,
}

struct GPUData {
    number: int,
    active: bool,
}

component FireSVG inherits Image {
    source: @image-url("IMAGE_URL_PATH");
    width: 100%;
    height: 100%;
    image-fit: contain;
}

component CustomButton inherits Rectangle {
    callback clicked;
    in property <string> text;
    in property <bool> active;

    height: 40px;
    width: 120px;
    background: active ? #ff4500 : #4a4a4a;
    border-radius: 4px;

    animate background { duration: 150ms; }

    Text {
        color: white;
        text: parent.text;
        font-size: 16px;
        font-weight: 700;
        horizontal-alignment: center;
        vertical-alignment: center;
    }

    TouchArea {
        clicked => {
            parent.clicked();
        }
    }
}

export component Window inherits Window {
    title: "BurnCPU";
    in-out property <[CPUData]> cpu-data: [];
    in-out property <[GPUData]> gpu-data: [];
    in property <int> active-cpus: 0;
    in property <int> active-gpus: 0;
    in-out property <int> gpu-complexity: 50; // Default to 50% complexity
    callback toggleCPU(int) -> bool;
    callback toggleGPU(int, int) -> bool; // Using complexity parameter

    background: #f0f0f0;
    width: 400px;
    height: 600px;

    VerticalBox {
        alignment: center;
        spacing: 20px;

        Text {
            horizontal-alignment: center;
            text: "BurnCPU";
            font-size: 32px;
            font-weight: 600;
            color: #ff4500;
        }

        Rectangle {
            width: 400px;
            height: root.active-cpus > 0 ? 160px : 0;
            background: transparent;

            FireSVG {
                x: (root.width - parent.width);
                horizontal-alignment: center;
                height: root.active-cpus > 0 ? 150px + 10px * root.active-cpus : 0;
                animate height {
                    duration: 300ms;
                    easing: ease-in-out;
                }
            }

            animate height {
                duration: 300ms;
                easing: ease-in-out;
            }
        }

        Rectangle {
            height: 5px;
            // Add some space between fire and buttons
        }

        for cpu[i] in cpu-data: HorizontalLayout {
            alignment: center;
            spacing: 10px;

            Rectangle {
                width: cpu.active ? 10px : 5px;
                height: cpu.active ? 20px : 10px;
                background: cpu.active ? #ff4500 : #808080;
                animate width, height, background { duration: 150ms; }
            }

            CustomButton {
                text: cpu.active ? "Stop Core " + (i + 1) : "Start Core " + (i + 1);
                active: cpu.active;
                clicked => {
                    cpu.active = toggleCPU(cpu.number);
                }
            }
        }
        
        // Separator between CPU and GPU sections
        if (gpu-data.length > 0): VerticalLayout {
            Rectangle {
                height: 1px;
                background: #cccccc;
                width: 80%;
            }
            
            Rectangle {
                height: 20px; // Spacing
            }
            
            Text {
                text: "GPU Stress Test";
                font-size: 18px;
                font-weight: 500;
                horizontal-alignment: center;
                color: #333333;
            }
        }
        
        // No GPU complexity controls here anymore
        
        for gpu[i] in gpu-data: HorizontalLayout {
            alignment: center;
            spacing: 10px;

            Rectangle {
                width: gpu.active ? 10px : 5px;
                height: gpu.active ? 20px : 10px;
                background: gpu.active ? #00aaff : #808080;
                animate width, height, background { duration: 150ms; }
            }

            CustomButton {
                text: gpu.active ? "Stop GPU " + (i + 1) : "Start GPU " + (i + 1);
                active: gpu.active;
                background: gpu.active ? #00aaff : #4a4a4a;
                clicked => {
                    gpu.active = toggleGPU(gpu.number, root.gpu-complexity);
                }
            }
        }
    }
}
